# Core logic for optimizing fills 